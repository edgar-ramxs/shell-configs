#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys
from rembg import remove
from PIL import Image
import os

def quitar_fondo_a_imagen(ruta_entrada, ruta_salida):
    """
    Carga una imagen, utiliza rembg para quitar el fondo
    y guarda el resultado.
    """
    try:
        # 1. Cargar la imagen usando PIL (Pillow)
        print(f"âœ… Cargando imagen de entrada: {ruta_entrada}")
        input_image = Image.open(ruta_entrada)

        # 2. Procesar la imagen con rembg para quitar el fondo
        print("â³ Eliminando el fondo de la imagen...")
        output_image = remove(input_image)

        # 3. Guardar la imagen de salida
        output_image.save(ruta_salida)
        print(f"ğŸ‰ Â¡Fondo eliminado! Imagen guardada en: {ruta_salida}")

    except FileNotFoundError:
        print(f"âŒ ERROR: No se encontrÃ³ el archivo en la ruta: {ruta_entrada}")
        print("AsegÃºrate de que la ruta del archivo sea correcta.")
    except Exception as e:
        print(f"âŒ OcurriÃ³ un error inesperado: {e}")

if __name__ == "__main__":
    # La forma ideal de ejecutarlo es pasar la ruta de la imagen por terminal.
    if len(sys.argv) < 2:
        print("ğŸ›‘ Uso incorrecto.")
        # Muestra el nombre del script para el ejemplo de uso.
        script_name = os.path.basename(__file__)
        print(f"Ejecuta: ./{script_name} <ruta/a/imagen_entrada.jpg>")
    else:
        # Toma la primera ruta pasada como argumento
        input_path = sys.argv[1]
        
        # Genera el nombre del archivo de salida
        base_name, ext = os.path.splitext(input_path)
        output_path = f"{base_name}_sin_fondo.png"
        
        quitar_fondo_a_imagen(input_path, output_path)
